generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String             @id @default(cuid())
  name              String?
  email             String             @unique
  emailVerified     DateTime?
  image             String?
  password          String?
  role              Role               @default(USER)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  phoneNumber       String?
  accounts          Account[]
  createdCourses    Course[]
  courseEnrollments CourseEnrollment[]
  nutritionLogs     NutritionLog[]
  profile           Profile?
  purchases         Purchase[]
  reviews           Review[]
  sessions          Session[]
  subscriptions     Subscription[]
  assignedTrainers  TrainerClient[]    @relation("ClientToTrainers")
  assignedClients   TrainerClient[]    @relation("TrainerToClients")
  trainerProfile    TrainerProfile?
  createdWorkouts   Workout[]          @relation("WorkoutCreator")
  workoutLogs       WorkoutLog[]

  @@index([email])
  @@index([role])
}

model Profile {
  id               String            @id @default(cuid())
  userId           String            @unique
  dateOfBirth      DateTime?
  gender           Gender?
  height           Float?
  currentWeight    Float?
  targetWeight     Float?
  activityLevel    ActivityLevel?
  fitnessGoal      FitnessGoal?
  bmi              Float?
  bmr              Float?
  tdee             Float?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  targetCalories   Float?
  targetCarbs      Float?
  targetFats       Float?
  targetProtein    Float?
  useCustomTargets Boolean           @default(false)
  measurements     BodyMeasurement[]
  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model BodyMeasurement {
  id         String   @id @default(cuid())
  profileId  String
  weight     Float?
  bodyFat    Float?
  muscleMass Float?
  chest      Float?
  waist      Float?
  hips       Float?
  arms       Float?
  thighs     Float?
  notes      String?
  photoUrl   String?
  measuredAt DateTime @default(now())
  createdAt  DateTime @default(now())
  profile    Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([measuredAt])
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Exercise {
  id               String            @id @default(cuid())
  name             String
  description      String?
  instructions     String?
  muscleGroups     MuscleGroup[]
  equipment        EquipmentType[]
  difficulty       DifficultyLevel   @default(BEGINNER)
  videoUrl         String?
  thumbnailUrl     String?
  isPublic         Boolean           @default(true)
  createdById      String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  defaultReps      Int?
  defaultWeight    Float?
  exerciseLogs     ExerciseLog[]
  workoutExercises WorkoutExercise[]

  @@index([name])
  @@index([isPublic])
}

model Workout {
  id            String            @id @default(cuid())
  name          String
  description   String?
  difficulty    DifficultyLevel   @default(BEGINNER)
  estimatedTime Int?
  isTemplate    Boolean           @default(true)
  isPublic      Boolean           @default(true)
  createdById   String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  createdBy     User?             @relation("WorkoutCreator", fields: [createdById], references: [id])
  exercises     WorkoutExercise[]
  workoutLogs   WorkoutLog[]

  @@index([isPublic])
  @@index([isTemplate])
  @@index([createdById])
}

model WorkoutExercise {
  id         String   @id @default(cuid())
  workoutId  String
  exerciseId String
  order      Int
  sets       Int      @default(3)
  reps       Int?
  duration   Int?
  rest       Int?
  notes      String?
  createdAt  DateTime @default(now())
  exercise   Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  workout    Workout  @relation(fields: [workoutId], references: [id], onDelete: Cascade)

  @@index([workoutId])
  @@index([exerciseId])
}

model WorkoutLog {
  id                   String        @id @default(cuid())
  userId               String
  workoutId            String?
  title                String
  notes                String?
  duration             Int?
  restUntil            DateTime?
  currentExerciseOrder Int?
  currentSetNumber     Int?
  startedAt            DateTime
  completedAt          DateTime?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  exerciseLogs         ExerciseLog[]
  user                 User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  workout              Workout?      @relation(fields: [workoutId], references: [id])

  @@index([userId])
  @@index([startedAt])
}

model ExerciseLog {
  id           String     @id @default(cuid())
  workoutLogId String
  exerciseId   String
  notes        String?
  createdAt    DateTime   @default(now())
  exercise     Exercise   @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  workoutLog   WorkoutLog @relation(fields: [workoutLogId], references: [id], onDelete: Cascade)
  sets         SetLog[]

  @@index([workoutLogId])
  @@index([exerciseId])
}

model SetLog {
  id            String      @id @default(cuid())
  exerciseLogId String
  setNumber     Int
  reps          Int?
  weight        Float?
  duration      Int?
  distance      Float?
  completed     Boolean     @default(true)
  createdAt     DateTime    @default(now())
  exerciseLog   ExerciseLog @relation(fields: [exerciseLogId], references: [id], onDelete: Cascade)

  @@index([exerciseLogId])
}

model Food {
  id            String         @id @default(cuid())
  name          String
  description   String?
  calories      Float
  protein       Float
  carbs         Float
  fats          Float
  fiber         Float?
  sugar         Float?
  servingSize   Float?
  servingUnit   String?
  isPublic      Boolean        @default(true)
  createdById   String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  mealPlanFoods MealPlanFood[]
  nutritionLogs NutritionLog[]

  @@index([name])
  @@index([isPublic])
}

model MealPlan {
  id             String         @id @default(cuid())
  name           String
  description    String?
  targetCalories Float?
  targetProtein  Float?
  targetCarbs    Float?
  targetFats     Float?
  isTemplate     Boolean        @default(true)
  isPublic       Boolean        @default(true)
  createdById    String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  meals          MealPlanFood[]

  @@index([isPublic])
}

model MealPlanFood {
  id         String   @id @default(cuid())
  mealPlanId String
  foodId     String
  mealType   MealType
  quantity   Float
  order      Int?
  createdAt  DateTime @default(now())
  food       Food     @relation(fields: [foodId], references: [id], onDelete: Cascade)
  mealPlan   MealPlan @relation(fields: [mealPlanId], references: [id], onDelete: Cascade)

  @@index([mealPlanId])
  @@index([foodId])
}

model NutritionLog {
  id         String   @id @default(cuid())
  userId     String
  foodId     String
  mealType   MealType
  quantity   Float
  calories   Float
  protein    Float
  carbs      Float
  fats       Float
  notes      String?
  consumedAt DateTime @default(now())
  createdAt  DateTime @default(now())
  food       Food     @relation(fields: [foodId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([consumedAt])
  @@index([foodId])
}

model TrainerProfile {
  id                 String   @id @default(cuid())
  userId             String   @unique
  bio                String?
  specializations    String[]
  certifications     String[]
  yearsExperience    Int?
  hourlyRate         Float?
  instagramUrl       String?
  twitterUrl         String?
  websiteUrl         String?
  isVerified         Boolean  @default(false)
  isAcceptingClients Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isVerified])
}

model TrainerClient {
  id        String       @id @default(cuid())
  trainerId String
  clientId  String
  status    ClientStatus @default(INVITED)
  startDate DateTime     @default(now())
  endDate   DateTime?
  notes     String?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  client    User         @relation("ClientToTrainers", fields: [clientId], references: [id], onDelete: Cascade)
  trainer   User         @relation("TrainerToClients", fields: [trainerId], references: [id], onDelete: Cascade)

  @@unique([trainerId, clientId])
  @@index([trainerId])
  @@index([clientId])
  @@index([status])
}

model Course {
  id               String             @id @default(cuid())
  trainerId        String
  title            String
  description      String
  shortDescription String?
  category         CourseCategory
  duration         Int?
  difficulty       DifficultyLevel    @default(BEGINNER)
  price            Float
  currency         String             @default("USD")
  thumbnailUrl     String?
  previewVideoUrl  String?
  isPublished      Boolean            @default(false)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  trainer          User               @relation(fields: [trainerId], references: [id], onDelete: Cascade)
  enrollments      CourseEnrollment[]

  @@index([trainerId])
  @@index([isPublished])
  @@index([category])
}

model CourseEnrollment {
  id          String    @id @default(cuid())
  courseId    String
  userId      String
  enrolledAt  DateTime  @default(now())
  completedAt DateTime?
  progress    Float     @default(0)
  course      Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([courseId, userId])
  @@index([userId])
  @@index([courseId])
}

model Product {
  id               String            @id @default(cuid())
  name             String
  description      String
  shortDescription String?
  type             ProductType
  price            Float
  currency         String            @default("USD")
  features         String[]
  imageUrl         String?
  isActive         Boolean           @default(true)
  isFeatured       Boolean           @default(false)
  subscriptionTier SubscriptionTier?
  billingPeriod    String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  purchases        Purchase[]
  reviews          Review[]

  @@index([isActive])
  @@index([type])
  @@index([isFeatured])
}

model Purchase {
  id              String   @id @default(cuid())
  userId          String
  productId       String
  amount          Float
  currency        String   @default("USD")
  paymentProvider String?
  paymentId       String?
  purchasedAt     DateTime @default(now())
  product         Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([productId])
}

model Subscription {
  id          String             @id @default(cuid())
  userId      String
  tier        SubscriptionTier
  status      SubscriptionStatus
  startDate   DateTime           @default(now())
  endDate     DateTime?
  cancelledAt DateTime?
  autoRenew   Boolean            @default(true)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([tier])
}

model Review {
  id                 String   @id @default(cuid())
  userId             String
  productId          String
  rating             Int
  title              String?
  comment            String?
  isVerifiedPurchase Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  product            Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([productId])
  @@index([rating])
}

model Notification {
  id        String           @id @default(cuid())
  userId    String
  type      NotificationType
  title     String
  message   String
  link      String?
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
}

enum Role {
  USER
  TRAINER
  ADMIN
}

enum CourseCategory {
  STRENGTH_TRAINING
  CARDIO
  YOGA
  PILATES
  HIIT
  BODYBUILDING
  WEIGHT_LOSS
  FLEXIBILITY
  SPORTS_SPECIFIC
  GENERAL_FITNESS
}

enum Gender {
  MALE
  FEMALE
  OTHER
  PREFER_NOT_TO_SAY
}

enum ActivityLevel {
  SEDENTARY
  LIGHTLY_ACTIVE
  MODERATELY_ACTIVE
  VERY_ACTIVE
  EXTRA_ACTIVE
}

enum FitnessGoal {
  LOSE_WEIGHT
  GAIN_MUSCLE
  MAINTAIN_WEIGHT
  IMPROVE_ENDURANCE
  GENERAL_FITNESS
}

enum MuscleGroup {
  CHEST
  BACK
  SHOULDERS
  BICEPS
  TRICEPS
  FOREARMS
  ABS
  OBLIQUES
  QUADS
  HAMSTRINGS
  GLUTES
  CALVES
  FULL_BODY
  CARDIO
}

enum EquipmentType {
  BARBELL
  DUMBBELL
  KETTLEBELL
  CABLE
  MACHINE
  BODYWEIGHT
  RESISTANCE_BAND
  CARDIO_EQUIPMENT
  OTHER
}

enum DifficultyLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum MealType {
  BREAKFAST
  LUNCH
  DINNER
  SNACK
  PRE_WORKOUT
  POST_WORKOUT
}

enum ClientStatus {
  INVITED
  ACTIVE
  INACTIVE
  CANCELLED
}

enum ProductType {
  WORKOUT_PROGRAM
  MEAL_PLAN
  COACHING_PACKAGE
  SUBSCRIPTION
  DIGITAL_PRODUCT
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
  TRIAL
}

enum SubscriptionTier {
  FREE
  BASIC
  PREMIUM
  ENTERPRISE
}

enum NotificationType {
  WORKOUT_ASSIGNED
  MEAL_PLAN_ASSIGNED
  SUBSCRIPTION_EXPIRING
  NEW_MESSAGE
  ACHIEVEMENT
  SYSTEM
}

enum AchievementType {
  WORKOUT_COUNT
  STREAK
  VOLUME
  DURATION
  CONSISTENCY
  PERSONAL_RECORD
  VARIETY
  EARLY_BIRD
  NIGHT_OWL
  WEEKEND_WARRIOR
  NUTRITION
}

enum AchievementTier {
  BRONZE
  SILVER
  GOLD
  PLATINUM
  DIAMOND
}

model Achievement {
  id          String          @id @default(cuid())
  userId      String
  type        AchievementType
  tier        AchievementTier
  title       String
  description String
  icon        String
  target      Int
  progress    Int             @default(0)
  isUnlocked  Boolean         @default(false)
  unlockedAt  DateTime?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([userId])
  @@index([type])
  @@index([isUnlocked])
}
